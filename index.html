<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>GY-GY Club v4.3</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; outline: none !important; }
        body { margin: 0; background: #000; color: #d4af37; font-family: 'Times New Roman', serif; text-align: center; height: 100vh; width: 100vw; overflow: hidden; }
        
        /* СИСТЕМА ЭКРАНОВ */
        .block { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            display: none; flex-direction: column; align-items: center; justify-content: center; 
            padding: 20px; background: #000;
        }
        .block.active { display: flex !important; }

        /* БЛОК 1: ТЕРМИНАЛ РЕГИСТРАЦИИ */
        #quote-reg { font-style: italic; font-size: 26px; line-height: 1.4; margin-bottom: 40px; color: #d4af37; max-width: 85%; }
        .setup-grid { display: grid; grid-template-columns: repeat(3, 95px); gap: 15px; margin-bottom: 40px; }
        .square-box { width: 95px; height: 95px; border: 1px solid #d4af37; background: #fff; display: flex; align-items: center; justify-content: center; overflow: hidden; color: #000; }
        
        /* БЛОК 2: ХОЛЛ С ДИВАНОМ */
        .hologram-frame { 
            border: 1px solid rgba(212, 175, 55, 0.2); padding: 30px; 
            background: rgba(212,175,55,0.02); backdrop-filter: blur(15px);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.1);
        }
        .user-img-hall { width: 180px; height: 180px; object-fit: cover; border: 1px solid #d4af37; margin-bottom: 20px; filter: sepia(0.4); }
        .id-text-hall { font-size: 22px; letter-spacing: 6px; font-family: 'Courier New', monospace; }

        /* КНОПКИ */
        .btn-gold { width: 180px; height: 45px; background: transparent; border: 1px solid #d4af37; color: #d4af37; text-transform: uppercase; font-size: 11px; letter-spacing: 2px; cursor: pointer; transition: 0.4s; }
        #btn-to-hall { visibility: hidden; background: rgba(212, 175, 55, 0.1); }

        .ver-tag { position: absolute; bottom: 10px; width: 100%; font-size: 10px; opacity: 0.2; letter-spacing: 1px; }
    </style>
</head>
<body>

    <audio id="bg-ambient" loop><source src="bar_ambient.mp3" type="audio/mpeg"></audio>

    <div id="scr-reg" class="block active">
        <div id="quote-reg">«В каждой шутке есть доля виски...»</div>
        <div class="setup-grid">
            <div class="square-box" style="flex-direction:column; font-size:10px;">
                <span style="opacity:0.5;">ID TRACE</span>
                <div id="id-display" style="font-weight:bold; margin-top:5px;">#0042-XXXX</div>
            </div>
            <div id="qrcode" class="square-box"></div>
            <div class="square-box" style="cursor:pointer;" onclick="document.getElementById('f-in').click()">
                <span id="label-ph" style="font-size:10px; font-weight:bold;">PHOTO</span>
                <img id="prev-ph" style="display:none; width:100%; height:100%; object-fit:cover;">
            </div>
        </div>
        <div style="display:flex; gap: 20px;">
            <button id="btn-save" class="btn-gold" onclick="saveData()">СОХРАНИТЬ</button>
            <button id="btn-to-hall" class="btn-gold" onclick="enterHall()">ВХОД</button>
        </div>
        <input type="file" id="f-in" style="display:none" onchange="loadPhoto(this)">
        <div class="ver-tag">v4.3 | TERMINAL</div>
    </div>

    <div id="scr-hall" class="block">
        <div class="hologram-frame">
            <div style="font-size: 9px; letter-spacing: 2px; margin-bottom: 15px; opacity: 0.5;">IDENTITY RECOGNIZED</div>
            <img id="hall-photo" class="user-img-hall" src="" style="display:none;">
            <div id="hall-id" class="id-text-hall">#SCANNING...</div>
        </div>
        <h2 style="letter-spacing: 15px; margin-top: 30px; opacity: 0.8; font-weight: normal;">HALL</h2>
        <div class="ver-tag">v4.3 | INTERNAL</div>
    </div>

    <script>
        // Генерируем ID при загрузке
        const guestID = `#0042-${Math.floor(1000 + Math.random() * 9000)}`;
        const ambient = document.getElementById('bg-ambient');

        // Инициализация QR при загрузке страницы
        window.onload = () =>
